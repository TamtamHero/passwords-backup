(this["webpackJsonppasswords-backup"]=this["webpackJsonppasswords-backup"]||[]).push([[0],{151:function(e,t,n){},153:function(e,t,n){},154:function(e,t,n){"use strict";n.r(t);var r=n(1),s=n(0),a=n.n(s),c=n(12),o=n.n(c),i=(n(68),n(8)),u=n(2),l=n.n(u),h=n(3),p=n.p+"static/media/logo.aeffe6a7.svg";n(70);var d=function(e){var t=e.text,n=e.color,a=e.disabled,c=e.hidden,o=e.onClick,u=Object(s.useState)(!1),l=Object(i.a)(u,2),h=l[0],p=l[1],d=Object(s.useRef)(null),b=Object(s.useCallback)((function(){p(!0),d.current&&d.current.click()}),[]),f=Object(s.useCallback)((function(e){e.target.files[0].text().then((function(t){e.target.value="",o(t).then((function(){return p(!1)}))}))}),[o]);return Object(r.jsxs)("button",{className:"RestoreButton",disabled:h|a,onClick:h?null:b,style:{margin:"10px",backgroundColor:n,display:!c||"none"},children:[h?"Loading\u2026":t,Object(r.jsx)("input",{type:"file",ref:d,onChange:f,accept:".json",style:{display:"none"}})]})};n(71);var b=function(e){var t=e.text,n=e.color,a=e.disabled,c=e.hidden,o=e.onClick,u=Object(s.useState)(!1),l=Object(i.a)(u,2),h=l[0],p=l[1],d=Object(s.useCallback)((function(){p(!0),o().then((function(e){e&&function(e){var t=new Blob([JSON.stringify(e,null,4)],{type:"application/json;charset=utf-8"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download="backup.json",document.body.appendChild(r),r.click(),document.body.removeChild(r)}(e),p(!1)}))}),[o]);return Object(r.jsx)("button",{className:"BackupButton",disabled:h|a,onClick:h?null:d,style:{margin:"10px",backgroundColor:n,display:!c||"none"},children:h?"Loading\u2026":t})},f=n(54),j=n(6),v=n(21),g=n.n(v);n(151);function m(){var e=Object(s.useState)([]),t=Object(i.a)(e,2),n=t[0],a=t[1];return Object(r.jsxs)(j.a,{allowZeroExpanded:!0,allowMultipleExpanded:!0,onChange:function(e){if(e.length>n.length){var t=e[e.length-1],r=document.getElementById("accordion__panel-".concat(t)).getBoundingClientRect().bottom;r>window.innerHeight&&window.scrollBy(0,r-window.innerHeight)}a(e)},children:[Object(r.jsxs)(j.b,{children:[Object(r.jsx)(j.d,{children:Object(r.jsx)(j.c,{children:"What is this Web App ?"})}),Object(r.jsx)(j.e,{children:Object(r.jsx)(g.a,{className:"Explanations",children:"This Web App allows you to backup/restore the list of `password nicknames` stored inside the `Passwords app` on your Ledger Nano S/ Nano X.  \n    It is useful to have such a backup when you update the Passwords app on your device, or the device firmware, because the list gets erased. Another case where it's practical to have a nickname backup is when you loose your device: Restoring the [24-words recovery phrase](https://www.ledger.com/academy/crypto/what-is-a-recovery-phrase) is necessary but not sufficient to restore your passwords, you need your nickname list as well."})})]}),Object(r.jsxs)(j.b,{children:[Object(r.jsx)(j.d,{children:Object(r.jsx)(j.c,{children:"What is the Ledger Passwords application ?"})}),Object(r.jsx)(j.e,{children:Object(r.jsx)(g.a,{className:"Explanations",children:"Look [here](https://github.com/LedgerHQ/app-passwords/blob/master/README.md) for more information on the device application itself."})})]}),Object(r.jsxs)(j.b,{children:[Object(r.jsx)(j.d,{children:Object(r.jsx)(j.c,{children:"How to use this Web App ?"})}),Object(r.jsx)(j.e,{children:Object(r.jsx)(g.a,{className:"Explanations",children:'* Connect your Nano S/X to your computer and open the `Passwords app`.\n* You can now click on the big `Connect` button, and if it succeeds the `Backup` and `Restore` buttons should replace the previous button. If you have troubles with this step, have a look [here](https://support.ledger.com/hc/en-us/articles/115005165269-Fix-connection-issues). \n* Either click on `Backup` or `Restore` depending on what you want to do:  \n    * `Backup` will prompt a screen requesting your approval on your device (`"Transfer metadatas ?"`), then save a backup file. This is your backup. it\'s not confidential, so for instance you can send it to yourself by e-mail to never loose it.  \n    * `Restore` will prompt a file input dialog where you should indicate a previous backup file. A prompt (`"Overwite metadatas ?"`) will then request your approval on your device. Done.'})})]}),Object(r.jsxs)(j.b,{children:[Object(r.jsx)(j.d,{children:Object(r.jsx)(j.c,{children:"Which web browsers are supported ?"})}),Object(r.jsx)(j.e,{children:Object(r.jsx)(g.a,{className:"Explanations",children:"The communication with the device is done through `WebUSB`, which is curently supported only on `Google Chrome` / `Chromium` / `Brave` for `Linux` and `MacOS`. On `Windows`, [Zadig](https://github.com/WICG/webusb/issues/143) is required."})})]})]})}var w=n(13),k=(n(152),n(20)),x=n(60);n(153);Object(k.a)((function(e){console.log(e)}));var O=function(){function e(e,t){return new Promise(function(){var n=Object(h.a)(l.a.mark((function n(r){var s;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s=null,n.prev=1,e.connected){n.next=7;break}return n.next=5,e.connect();case 5:v(!0),w.b.info("Device connected \ud83d\udc4c",{autoClose:!1});case 7:if(!t){n.next=15;break}return w.b.info("Approve action on your device \u2728",{autoClose:!1}),c(!0),n.next=12,t();case 12:s=n.sent,w.b.dismiss(),w.b.success("Success \ud83e\udd84");case 15:n.next=23;break;case 17:n.prev=17,n.t0=n.catch(1),e.disconnect(),v(!1),w.b.dismiss(),w.b.error("".concat(n.t0.toString()," \ud83d\ude45"));case 23:return n.prev=23,c(!1),r(s),n.finish(23);case 27:case"end":return n.stop()}}),n,null,[[1,17,23,27]])})));return function(e){return n.apply(this,arguments)}}())}var t=Object(s.useState)(!1),n=Object(i.a)(t,2),a=n[0],c=n[1],o=Object(s.useState)(!1),u=Object(i.a)(o,2),j=u[0],v=u[1],g=Object(s.useState)(new f.a(!0)),k=Object(i.a)(g,1)[0];return Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)(w.a,{hideProgressBar:!0}),Object(r.jsxs)("div",{className:"App-banner",children:[Object(r.jsx)("img",{src:p,className:"App-logo",alt:"logo"}),Object(r.jsx)("p",{className:"App-title",children:"Passwords Backup"})]}),Object(r.jsxs)("header",{className:"App-header",children:[Object(r.jsxs)("div",{className:"Commands",children:[Object(r.jsx)(b,{text:"Backup",color:"#41ccb4",disabled:a,hidden:!j,onClick:function(){return e(k,(function(){return k.dump_metadatas()}))}}),Object(r.jsx)(d,{text:"Restore",color:"#FFB86D",disabled:a,hidden:!j,onClick:function(t){return e(k,(function(){return k.load_metadatas(t)}))}}),Object(r.jsx)(b,{text:"Connect",color:"#41ccb4",disabled:a,hidden:j,onClick:function(){return e(k)}})]}),Object(r.jsx)(m,{}),Object(r.jsx)("div",{className:"App-footer",children:Object(r.jsxs)("p",{children:["A modest Web App built at Ledger with React, hosted by Github. v","".concat(x.version),". ",Object(r.jsx)("a",{href:"https://github.com/LedgerHQ/passwords-backup",children:"PRs welcomed and appreciated \u2728"})]})})]})]})};o.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(O,{})}),document.getElementById("root"))},54:function(e,t,n){"use strict";(function(e){var r=n(2),s=n.n(r),a=n(8),c=n(3),o=n(16),i=n(17),u=n(55),l=function(){function t(){Object(o.a)(this,t),this.allowedStatuses=[36864,27013,27270,27271,27904,28160,45056],this.connected=!1,this.busy=!1,this.transport=null}return Object(i.a)(t,[{key:"connect",value:function(){var e=Object(c.a)(s.a.mark((function e(){var t,n,r,c,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connected){e.next=28;break}if(this.transport){e.next=5;break}return e.next=4,u.a.create();case 4:this.transport=e.sent;case 5:return e.prev=5,e.next=8,this.getAppInfo();case 8:if(t=e.sent,n=Object(a.a)(t,2),r=n[0],c=n[1],"Passwords"===r.toString()){e.next=14;break}throw new Error("The Passwords app is not opened on the device");case 14:return this.version=c,e.next=17,this.getAppConfig();case 17:o=e.sent,this.storage_size=o.storage_size,this.connected=!0,e.next=28;break;case 22:return e.prev=22,e.t0=e.catch(5),e.next=26,this.transport.close();case 26:throw this.disconnect(),e.t0;case 28:case"end":return e.stop()}}),e,this,[[5,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"isSuccess",value:function(e){return e.length>=2&&36864===e.readUInt16BE(e.length-2)}},{key:"disconnect",value:function(){this.connected=!1,this.transport=null}},{key:"mapProtocolError",value:function(e){if(e.length<2)throw new Error("Response length is too small");var t={27013:"Action cancelled",27270:"SW_WRONG_P1P2",27271:"SW_WRONG_DATA_LENGTH",27904:"SW_INS_NOT_SUPPORTED",28160:"SW_CLA_NOT_SUPPORTED",45056:"SW_APPNAME_TOO_LONG",28432:"SW_METADATAS_PARSING_ERROR"},n=e.readUInt16BE(e.length-2);if(n in t)throw new Error(t[n])}},{key:"_lock",value:function(){if(this.busy)throw new Error("Device is busy");this.busy=!0}},{key:"_unlock",value:function(){this.busy=!1}},{key:"_toBytes",value:function(t){var n=this,r=e.alloc(this.storage_size),s=JSON.parse(t).parsed,a=0;return s.forEach((function(e){var t=e.nickname,s=e.charsets;if(t.length>19)throw new Error("Nickname too long (19 max): ".concat(t," has length ").concat(t.length));if(a+3+t.length>=n.storage_size)throw new Error("Not enough memory on this device to restore this backup");r[a++]=t.length+1,r[a++]=0,r[a++]=s,r.write(t,a),a+=t.length})),r[a++]=0,r[a++]=0,r}},{key:"_toJSON",value:function(e){for(var t=[],n=[],r=0,s=[];;){var a=e[r];if(0===a)break;var c=255===e[r+1],o=e[r+2];a>20&&(s+=[r,"nickname too long ".concat(a,", max is 19")]),c?n.push({nickname:e.slice(r+3,r+2+a).toString(),charsets:o}):t.push({nickname:e.slice(r+3,r+2+a).toString(),charsets:o}),r+=a+2}return{parsed:t,nicknames_erased_but_still_stored:n,corruptions_encountered:s,raw_metadatas:e.toString("hex")}}},{key:"_load_metadatas_chunk",value:function(){var t=Object(c.a)(s.a.mark((function t(n,r){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.transport.send(224,5,r?255:0,0,e.from(n),this.allowedStatuses);case 2:return a=t.sent,this.isSuccess(a)||this.mapProtocolError(a),t.abrupt("return",a);case 5:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getAppInfo",value:function(){var t=Object(c.a)(s.a.mark((function t(){var n,r,a,c,o,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._lock(),t.prev=1,t.next=4,this.transport.send(176,1,0,0,e(0),this.allowedStatuses);case 4:return n=t.sent,this.isSuccess(n)||this.mapProtocolError(n),n=n.slice(0,n.length-2),t.prev=7,c=1,o=n[c++],r=n.slice(c,c+o).toString(),c+=o,i=n[c++],a=n.slice(c,c+i).toString(),t.abrupt("return",[r,a]);case 17:throw t.prev=17,t.t0=t.catch(7),new Error("Unexpected result from device, parsing error: ".concat(t.t0));case 20:return t.prev=20,this._unlock(),t.finish(20);case 23:case"end":return t.stop()}}),t,this,[[1,,20,23],[7,17]])})));return function(){return t.apply(this,arguments)}}()},{key:"getAppConfig",value:function(){var t=Object(c.a)(s.a.mark((function t(){var n,r,a,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._lock(),t.prev=1,t.next=4,this.transport.send(224,3,0,0,e(0),this.allowedStatuses);case 4:if(n=t.sent,this.isSuccess(n)||this.mapProtocolError(n),6===(n=n.slice(0,n.length-2)).length){t.next=9;break}throw new Error("Can't parse app config of length ".concat(n.length));case 9:return r=n.readUInt32BE(0,4),a=n[4],c=n[5],t.abrupt("return",{storage_size:r,keyboard_type:a,press_enter_after_typing:c});case 13:return t.prev=13,this._unlock(),t.finish(13);case 16:case"end":return t.stop()}}),t,this,[[1,,13,16]])})));return function(){return t.apply(this,arguments)}}()},{key:"dump_metadatas",value:function(){var t=Object(c.a)(s.a.mark((function t(){var n,r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._lock(),t.prev=1,n=e.alloc(0);case 3:if(!(n.length<this.storage_size)){t.next=13;break}return t.next=6,this.transport.send(224,4,0,0,e(0),this.allowedStatuses);case 6:if(r=t.sent,this.isSuccess(r)||this.mapProtocolError(r),n=e.concat([n,e.from(r.slice(1,-2))]),!(255===r[0]&&n.length<this.storage_size)){t.next=11;break}throw new Error("".concat(this.storage_size," bytes requested but only ").concat(n.length," bytes available"));case 11:t.next=3;break;case 13:return t.abrupt("return",this._toJSON(n));case 14:return t.prev=14,this._unlock(),t.finish(14);case 17:case"end":return t.stop()}}),t,this,[[1,,14,17]])})));return function(){return t.apply(this,arguments)}}()},{key:"load_metadatas",value:function(){var e=Object(c.a)(s.a.mark((function e(t){var n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._lock(),e.prev=1,0!==(n=this._toBytes(t)).length){e.next=5;break}throw new Error("No data to load");case 5:r=0;case 6:if(!(r<n.length)){e.next=13;break}return a=n.slice(r,r+255),e.next=10,this._load_metadatas_chunk(a,r+a.length===n.length);case 10:r+=255,e.next=6;break;case 13:return e.prev=13,this._unlock(),e.finish(13);case 16:case"end":return e.stop()}}),e,this,[[1,,13,16]])})));return function(t){return e.apply(this,arguments)}}()}]),t}();t.a=l}).call(this,n(23).Buffer)},60:function(e){e.exports=JSON.parse('{"name":"passwords-backup","version":"0.1.0","private":true,"homepage":"https://TamtamHero.github.io/passwords-backup","dependencies":{"@ledgerhq/hw-transport-webusb":"^5.28.0","@testing-library/jest-dom":"^5.11.4","@testing-library/react":"^11.1.0","@testing-library/user-event":"^12.1.10","install":"^0.13.0","react":"^17.0.1","react-accessible-accordion":"^3.3.3","react-dom":"^17.0.1","react-markdown":"^5.0.2","react-scripts":"4.0.0","react-toastify":"^6.0.9","web-vitals":"^0.2.4"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","predeploy":"npm run build","deploy":"gh-pages -d build"},"eslintConfig":{"extends":["react-app","react-app/jest"]},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"gh-pages":"^3.1.0"}}')},68:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){}},[[154,1,2]]]);
//# sourceMappingURL=main.1e6704ae.chunk.js.map